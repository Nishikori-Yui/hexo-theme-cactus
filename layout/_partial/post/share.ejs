<ul class="share">
    <li>
        <a class="icon copy-link"
           href="#"
           role="button"
           aria-label="Copy link">
            <i class="fa-regular fa-copy <%= icon_class_name %>" aria-hidden="true"></i>
        </a>
    </li>
</ul>

<script>
    (function () {
        if (typeof ClipboardJS !== 'undefined') {
            var clipboard = new ClipboardJS('.copy-link', {
                text: function(trigger) {
                    var u = '<%- page.permalink %>';
                    // If URL already contains percent-escapes, do NOT re-encode (to avoid %25â€¦)
                    return /%[0-9A-Fa-f]{2}/.test(u) ? u : encodeURI(u);
                }
            });
            clipboard.on('success', function (e) {
                const el = e.trigger;
                const old = el.getAttribute('aria-label') || 'Copy link';
                el.setAttribute('aria-label', 'Copied!');
                setTimeout(() => el.setAttribute('aria-label', old), 1500);
                e.clearSelection();
            });
        } else {
            const el = document.querySelector('.copy-link');
            if (el) {
                el.addEventListener('click', function(ev) {
                    ev.preventDefault();
                    const raw = '<%- page.permalink %>';
                    const url = /%[0-9A-Fa-f]{2}/.test(raw) ? raw : encodeURI(raw);
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(url);
                    } else {
                        window.prompt('Copy link:', url);
                    }
                });
            }
        }
    })();
</script>